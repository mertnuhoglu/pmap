
# Logs 20190729 

## Error: marker numaraları route sequence dışında da artmaya devam ediyor 20190729 

Marker numaraları burada atanıyor:

``` r
		icon_num = leaflet::makeAwesomeIcon(text = sqn, markerColor = routes$color[sqn])
``` 

``` r
		icon_num = leaflet::makeAwesomeIcon(text = routes$sequence_no[sqn], markerColor = routes$color[sqn])
``` 

``` r
state = init_state()
state$routes = get_routes_by_smi_wkd(v$init_routes_all, c(7,12), v$init_wkd_selected)
  ##>    salesman_id week_day from_point_id to_point_id from_lat from_lng to_lat to_lng sequence_no customer_name                  geometry prev_sequence_no
  ##>          <dbl>    <dbl>         <dbl>       <dbl>    <dbl>    <dbl>  <dbl>  <dbl>       <dbl> <chr>                      <LINESTRING>            <dbl>
  ##>  1           7        0             1        1371     40.9     29.2   41.0   29.1           0 0             (29.20862 40.89088, 29.2…               16
  ##>  2           7        0          1371        2328     41.0     29.1   41.0   29.1           1 HİLAL GIDA L… (29.13966 40.99389, 29.1…                0
  ##>  3           7        0          2328         939     41.0     29.1   41.0   29.1           2 PİYA SHOP     (29.13401 40.99387, 29.1…                1
``` 

## Error: renklendirmeyi düzelt 20190729 

Error: Her satıcı ayrı renk çalışmıyor

``` r
	state = init_state()
	v$init_wkd_selected = c(0,1)
	state$routes = get_routes_by_smi_wkd(v$init_routes_all, c(7,12), v$init_wkd_selected)
	state$routeSS = state$routes
	routes = state$routeSS

	coloring_select = "Her satıcı ayrı renk"
	map = make_map(routes, coloring_select)
	map
``` 

Debug `make_map()`

``` r
routes$col_per_route = 1:nrow(routes)
routes$col_per_smi_wkd = group_indices(routes, salesman_id, week_day)
routes$col_per_smi = group_indices(routes, salesman_id)
``` 

``` r
sf::st_geometry(routes) <- NULL
write_tsv(routes, "r01.tsv")
write_csv(routes, "r02.csv")
export(routes, "r03.xlsx")
``` 

sebep: dplyr::group_indices aynı sonucu veriyor ikisi için de

opt01: `ungroup` edip tekrar `group_by` yap

``` r
r01 = dplyr::ungroup(routes)
r02 = dplyr::group_by(r01, salesman_id)
dplyr::group_indices(r02, salesman_id)
``` 

``` r
	routes$col_per_smi = dplyr::ungroup(routes) %>%
		dplyr::group_by(salesman_id) %>%
		dplyr::group_indices(salesman_id)
export(routes, "r04.xlsx")
``` 

Tamam, bu çözdü sorunu.


